<!doctype html>
<html>

<head>
    <script src="js/utilities.js"></script>
	<script src="js/apptOps.js"></script>
	<link rel="stylesheet" type="text/css" href="css/toolTip.css"/>
	<?php include 'php/utilities.php'; ?>
    <title>Order Form Configuration</title>

	<script>
	function AJAX_UpdateQty(callingSlot) {
		window.alert("Quantity changed");
	}
	function AJAX_UpdateFX(callingSlot) {
		window.alert("Factor changed");
	}
	function AJAX_UpdateCQty(callingSlot) {
		window.alert("Category Quantity changed");
	}
	</script>
	
</head>

<body>
    <button onclick="goBack()">Go Back</button>
	<h1>
		Order Form: 
	<?php 
		$familyType = "";
		// Family Size 1-2
		if (isset($_GET["1to2"])) { echo "One to Two"; $familyType = "small"; }
		// Family Size 3-4
		if (isset($_GET["3to4"])) { echo "Three to Four"; $familyType = "medium"; }
		// Family Size 5+
		if (isset($_GET["5Plus"])) { echo "Five+"; $familyType = "large"; }
		// Walk-In Clients
		if (isset($_GET["Walkin"])) { echo "Walk-Ins"; $familyType = "walkIn"; }
		
		echo "</h1>";			

		// Display a chart
		// Get all of the categories and items (joined)
		// We need the $familyType field for each item and category and the factor for each item
		// CATEGORY NAME
		// CATEGORY QTY ($familyType)
		// Item List QTY, Factor
		
		$conn = createPantryDatabaseConnection();
		if ($conn->connect_error) {
			die("Connection failed: " . $conn->connect_error);
		}
		
		// *************************************************
		// * Query the database
		
		// Create our query from the Item and Category tables
		// Item Name, factor, $familyType, category name, category family type, itemid
		$sql = "SELECT itemID, itemName, Item." . $familyType . " as IQty, factor as fx, 
					Category.name as CName, Category." . $familyType . " as CQty
				FROM Item
				JOIN Category
				ON Item.categoryID=Category.categoryID
				WHERE isDeleted=0
				ORDER BY Category.name";

		$itemList = queryDB($conn, $sql);
		
		// ******************************************************
		// ** Create our table of information

		$currCategory = "";
		while ($item = sqlFetch($itemList)) {
			// if this is a new category
			if ($currCategory != $item['CName']) {
				// If we were in a different category, close off that category's table
				if ($currCategory != "") {
					echo "</table>";
				}
				// Print out the category name, followed by the selection qty and start a new table
				echo $item['CName'] . "<br>";
				echo "Selection Quantity: ";
				echo "<input type='number' min=0 value=" . $item['CQty'] . " onchange='AJAX_UpdateCQty(this)'><br>";
				$currCategory = $item['CName'];
				echo "<table><tr><th>Item Name</th><th>Qty</th><th>Fx</th></tr>";
			}
			// Print this item's name and have two number fields
			echo "<tr><td>" . $item['itemName'] . "</td>";
			echo "<td><input type='number' min=0 value=" . $item['IQty'] . " onchange='AJAX_UpdateQty(this)'></td>";
			echo "<td><input type='number' min=0 value=" . $item['fx'] . " onchange='AJAX_UpdateFX(this)'></td></tr>";
				 
			// AJAX Call
			//	echo " onchange='AJAX_SetAppointment(this)' >";
		}
		
	
	?>
	

</body>

</html>